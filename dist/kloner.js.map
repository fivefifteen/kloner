{"version":3,"file":"kloner.js","sources":["../src/kloner.js"],"sourcesContent":["/*!\n  kloner v0.0.1 (https://kloner.js.org)\n  by Kodie Grantham (https://kodieg.com)\n*/\n\nconst kloner = (containerSelector, childSelector, options) => {\n  if (childSelector && childSelector.constructor === Object) {\n    options = childSelector\n    childSelector = null\n  }\n\n  if (containerSelector && containerSelector.constructor === Object) {\n    options = containerSelector\n    containerSelector = null\n  }\n\n  options = Object.assign({}, kloner.defaultOptions, options || {})\n\n  if (containerSelector) {\n    options.containerSelector = containerSelector\n  }\n\n  if (childSelector) {\n    options.childSelector = childSelector\n  }\n\n  const containers = kloner.getInstances(options.containerSelector)\n\n  if (containers && containers.length) {\n    for (let i = 0; i < containers.length; i++) {\n      (function (container) {\n        const funcs = {\n          add: function (atIndex, options) {\n            return kloner.add(container, atIndex, options)\n          },\n          remove: function (atIndex, options) {\n            return kloner.remove(container, atIndex, options)\n          }\n        }\n\n        const opts = Object.assign({}, options, kloner.getAttributeOptions(container), funcs)\n\n        if (opts.template) {\n          const templateContainer = document.createElement(null)\n\n          templateContainer.innerHTML = opts.template\n\n          const templateElement = templateContainer.firstElementChild\n          const template = templateElement.cloneNode(true)\n\n          container.klonerTemplate = template\n          container.klonerTemplateIndex = 0\n\n          templateContainer.remove()\n        } else {\n          const templateElement = container.querySelector(opts.childSelector)\n\n          if (!templateElement) {\n            console.warn('[kloner] No template found:', opts.childSelector)\n            return\n          }\n\n          const template = templateElement.cloneNode(true)\n\n          container.klonerTemplate = template\n          container.klonerTemplateIndex = Array.prototype.indexOf.call(container.children, templateElement)\n\n          if (templateElement.matches('[data-kloner-template]')) {\n            templateElement.remove()\n          }\n        }\n\n        const existingChildren = container.querySelectorAll(opts.childSelector)\n        const count = existingChildren.length\n\n        for (let j = 0; j < count; j++) {\n          kloner.replaceParameters(existingChildren[j], Object.assign({}, opts.parameters || {}, {\n            index: j,\n            number: (j + 1)\n          }))\n        }\n\n        container.kloner = opts\n        container.klonerCount = count\n\n        kloner.initializeTriggers(container)\n\n        if (opts.start) {\n          let extraChildren = opts.start\n\n          if (!Array.isArray(extraChildren) && Number.isInteger(parseInt(extraChildren))) {\n            extraChildren = Array((parseInt(extraChildren) - container.klonerCount) || 0).fill({})\n          }\n\n          if (Array.isArray(extraChildren)) {\n            extraChildren.forEach(childParameters => {\n              opts.add(null, { parameters: childParameters })\n            })\n          }\n        }\n\n        if (opts.min && container.klonerCount < parseInt(opts.min)) {\n          for (let k = 0; k < (parseInt(opts.min) - container.klonerCount); k++) {\n            opts.add()\n          }\n        }\n\n        if (opts.max && container.klonerCount > parseInt(opts.max)) {\n          for (let l = 0; l < (container.klonerCount - parseInt(opts.max)); l++) {\n            opts.remove()\n          }\n        }\n      })(containers[i])\n    }\n  }\n\n  if (containers.length) {\n    if (containers.length === 1) {\n      return containers[0]\n    }\n\n    return containers\n  }\n\n  return false\n}\n\nkloner.add = (containerSelector, atIndex, options) => {\n  if (atIndex && atIndex.constructor === Object) {\n    options = atIndex\n    atIndex = null\n  }\n\n  if (containerSelector && containerSelector.constructor === Object) {\n    options = containerSelector\n    containerSelector = null\n  }\n\n  options = Object.assign({}, kloner.defaultOptions, options || {})\n\n  if (containerSelector) {\n    options.containerSelector = containerSelector\n  }\n\n  const containers = kloner.getInstances(options.containerSelector, true)\n\n  if (containers && containers.length) {\n    for (let i = 0; i < containers.length; i++) {\n      (function (container) {\n        const opts = Object.assign({}, options, options.kloner, kloner.getAttributeOptions(container))\n        const count = container.klonerCount\n\n        if (opts.max && count >= parseInt(opts.max)) {\n          return\n        }\n\n        const elements = container.querySelectorAll(opts.childSelector)\n        const element = container.klonerTemplate.cloneNode(true)\n\n        kloner.replaceParameters(element, Object.assign({}, opts.parameters || {}, {\n          index: count,\n          number: (count + 1)\n        }))\n\n        if (opts.beforeAdd && opts.beforeAdd(container, element, opts) === false) {\n          return false\n        }\n\n        const elementIndex = atIndex ?? elements.length ?? container.klonerTemplateIndex\n\n        if (elementIndex) {\n          if (elementIndex >= container.children.length) {\n            container.append(element)\n          } else {\n            container.insertBefore(\n              element,\n              container.children[elementIndex]\n            )\n          }\n        } else {\n          container.prepend(element)\n        }\n\n        container.klonerCount++\n\n        kloner.initializeTriggers(container)\n\n        if (opts.afterAdd) {\n          opts.afterAdd(container, element, opts)\n        }\n      })(containers[i])\n    }\n  }\n}\n\nkloner.defaultOptions = {\n  afterAdd: null,\n  afterRemove: null,\n  beforeAdd: null,\n  beforeRemove: null,\n  childSelector: '[data-kloner-template], :scope > *',\n  containerSelector: '[data-kloner], .kloner',\n  max: null,\n  min: 0,\n  parameters: null,\n  start: 0,\n  template: null\n}\n\nkloner.getAttributeOptions = (containerSelector) => {\n  if (!containerSelector) containerSelector = kloner.defaultOptions.containerSelector\n\n  const container = kloner.getInstances(containerSelector, false, true)\n\n  if (container) {\n    const data = Object.assign({}, container.dataset)\n    const regexp = /kloner([A-Z].*)/\n\n    return Object.keys(data)\n      .filter(key => regexp.test(key))\n      .reduce((obj, key) => {\n        const match = key.match(regexp)\n        const newKey = match[1][0].toLowerCase() + match[1].slice(1)\n        obj[newKey] = data[key]\n        return obj\n      }, {})\n  }\n\n  return {}\n}\n\nkloner.getInstances = (elements, verify, single) => {\n  if (typeof elements === 'string') {\n    elements = document.querySelectorAll(elements)\n  } else if (elements instanceof HTMLElement) {\n    elements = [elements]\n  }\n\n  if (verify) {\n    let verifiedElements = [] // eslint-disable-line prefer-const\n\n    for (let i = 0; i < elements.length; i++) {\n      (function (container) {\n        if (!container.kloner) {\n          console.warn('Element doesn\\'t appear to be a kloner instance:', container)\n          return\n        }\n\n        verifiedElements.push(container)\n      })(elements[i])\n    }\n\n    return verifiedElements\n  }\n\n  if (elements.length && single) {\n    return elements[0]\n  }\n\n  return elements\n}\n\nkloner.initializeTriggers = (containerSelector) => {\n  if (!containerSelector) containerSelector = kloner.defaultOptions.containerSelector\n\n  const containers = kloner.getInstances(containerSelector, true)\n\n  if (containers && containers.length) {\n    for (let i = 0; i < containers.length; i++) {\n      (function (container) {\n        let addElements = container.querySelectorAll('[data-kloner-add]')\n\n        if (container.id) {\n          addElements = Array.prototype.slice.call(addElements).concat(\n            Array.prototype.slice.call(\n              document.querySelectorAll('[data-kloner-add=\"' + container.id + '\"]')\n            )\n          )\n        }\n\n        if (addElements.length) {\n          for (let j = 0; j < addElements.length; j++) {\n            if (!addElements[j].klonerTrigger) {\n              addElements[j].addEventListener('click', function (e) {\n                let atIndex = null\n\n                if (!addElements[j].dataset.klonerAdd.length) {\n                  const child = addElements[j].closest(container.kloner.childSelector)\n\n                  if (child) {\n                    atIndex = Array.prototype.indexOf.call(container.children, child)\n                  }\n                }\n\n                container.kloner.add(atIndex, kloner.getAttributeOptions(addElements[j]))\n              })\n\n              addElements[j].klonerTrigger = true\n            }\n          }\n        }\n\n        let removeElements = container.querySelectorAll('[data-kloner-remove]')\n\n        if (container.id) {\n          removeElements = Array.prototype.slice.call(removeElements).concat(\n            Array.prototype.slice.call(\n              document.querySelectorAll('[data-kloner-remove=\"' + container.id + '\"]')\n            )\n          )\n        }\n\n        if (removeElements.length) {\n          for (let k = 0; k < removeElements.length; k++) {\n            if (!removeElements[k].klonerTrigger) {\n              removeElements[k].addEventListener('click', function (e) {\n                let atIndex = null\n\n                if (!removeElements[k].dataset.klonerRemove.length) {\n                  const child = removeElements[k].closest(container.kloner.childSelector)\n\n                  if (child) {\n                    atIndex = Array.prototype.indexOf.call(container.children, child)\n                  }\n                }\n\n                container.kloner.remove(atIndex, kloner.getAttributeOptions(removeElements[k]))\n              })\n\n              removeElements[k].klonerTrigger = true\n            }\n          }\n        }\n\n        let countElements = container.querySelectorAll('[data-kloner-count]')\n\n        if (container.id) {\n          countElements = Array.prototype.slice.call(countElements).concat(\n            Array.prototype.slice.call(\n              document.querySelectorAll('[data-kloner-count=\"' + container.id + '\"]')\n            )\n          )\n        }\n\n        if (countElements.length) {\n          for (let l = 0; l < countElements.length; l++) {\n            countElements[l].textContent = container.klonerCount\n          }\n        }\n      })(containers[i])\n    }\n  }\n}\n\nkloner.remove = (containerSelector, atIndex, options) => {\n  if (atIndex && atIndex.constructor === Object) {\n    options = atIndex\n    atIndex = null\n  }\n\n  if (containerSelector && containerSelector.constructor === Object) {\n    options = containerSelector\n    containerSelector = null\n  }\n\n  options = Object.assign({}, kloner.defaultOptions, options || {})\n\n  if (containerSelector) {\n    options.containerSelector = containerSelector\n  }\n\n  const containers = kloner.getInstances(options.containerSelector, true)\n\n  if (containers && containers.length) {\n    for (let i = 0; i < containers.length; i++) {\n      (function (container) {\n        const opts = Object.assign({}, options, options.kloner, kloner.getAttributeOptions(container))\n        const count = container.klonerCount\n\n        if (count <= 0 || (opts.min && count <= parseInt(opts.min))) {\n          return\n        }\n\n        const elements = container.querySelectorAll(opts.childSelector)\n        const indexLimit = (elements.length - 1)\n        let elementIndex = atIndex ?? indexLimit\n\n        if (elementIndex > indexLimit) {\n          elementIndex = indexLimit\n        }\n\n        const element = elements[elementIndex]\n\n        if (opts.beforeRemove && opts.beforeRemove(container, element, opts) === false) {\n          return false\n        }\n\n        element.remove()\n\n        container.klonerCount--\n\n        kloner.initializeTriggers(container)\n\n        if (opts.afterRemove) {\n          opts.afterRemove(container, element, opts)\n        }\n      })(containers[i])\n    }\n  }\n}\n\nkloner.replaceParameters = (element, parameters) => {\n  element.innerHTML = element.innerHTML.replaceAll(/\\{kloner-(\\w+)\\}/g, (match, key) => parameters[key] ?? match)\n}\n\nexport default kloner\n"],"names":["kloner","containerSelector","childSelector","options","constructor","Object","assign","defaultOptions","containers","getInstances","length","i","container","funcs","add","atIndex","remove","opts","getAttributeOptions","template","templateContainer","document","createElement","innerHTML","templateElement","firstElementChild","cloneNode","klonerTemplate","klonerTemplateIndex","querySelector","console","warn","Array","prototype","indexOf","call","children","matches","existingChildren","querySelectorAll","count","j","replaceParameters","parameters","index","number","klonerCount","initializeTriggers","start","extraChildren","isArray","Number","isInteger","parseInt","fill","forEach","childParameters","min","k","max","l","_ref","_atIndex","elements","element","beforeAdd","elementIndex","append","insertBefore","prepend","afterAdd","afterRemove","beforeRemove","data","dataset","regexp","keys","filter","key","test","reduce","obj","match","newKey","toLowerCase","slice","verify","single","HTMLElement","verifiedElements","push","addElements","id","concat","_loop","klonerTrigger","addEventListener","e","klonerAdd","child","closest","removeElements","_loop2","klonerRemove","countElements","textContent","_atIndex2","indexLimit","replaceAll","_parameters$key"],"mappings":"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"}